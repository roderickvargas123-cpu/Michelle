<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Para Michelle</title>

  <!-- (Opcional) Fuente bonita. Si no carga, usa la del sistema. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0b0b12;
      --bg2:#1b0f1c;
      --heart1:#ff3b6b;
      --heart2:#ff6aa2;
      --paper:#fff7f2;
      --ink:#2a1a1f;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100dvh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 700px at 50% 30%, rgba(255,70,155,.18), transparent 60%),
                  radial-gradient(900px 600px at 20% 80%, rgba(255,70,155,.10), transparent 55%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #fff;
      overflow:hidden;
}

    /* Canvas de efectos (corazones cayendo) */
        #fx{
          position: fixed;
          inset: 0;
          width: 100%;
          height: 100%;
          z-index: 0;
          pointer-events: none; /* no bloquea clicks del contenido */
        }


    .scene{
      width:min(820px, 92vw);
      padding: 28px 18px 46px;
      text-align:center;
      position:relative;
          z-index: 1; /* encima del canvas */
    }

    .hint{
      opacity:.85;
      font-size: 14px;
      margin-top: 18px;
      user-select:none;
    }

    /* Bot√≥n invisible que cubre el coraz√≥n */
    .heart-button{
      appearance:none;
      border:0;
      background:transparent;
      padding:0;
      cursor:pointer;
      display:inline-grid;
      place-items:center;
      margin-top: 8px;
      position:relative;
      outline-offset: 8px;
    }
    .heart-button:focus-visible{
      outline: 2px solid rgba(255,255,255,.6);
      border-radius: 18px;
    }

    .heart-wrap{
      width: min(420px, 78vw);
      aspect-ratio: 1 / 1;
      position:relative;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.55));
    }

    .heart-half{
      position:absolute;
      inset:0;
      transition: transform 900ms cubic-bezier(.2,.8,.2,1);
      will-change: transform;
    }

    .heart-half svg{
      width:100%;
      height:100%;
      display:block;
    }

    /* Efecto de ‚Äúlatido‚Äù suave al inicio */
    .heart-wrap{
      animation: pulse 2.2s ease-in-out infinite;
    }
    body.open .heart-wrap{
      animation: none;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.03); }
    }

    /* Apertura */
    body.open .heart-half.left{
      transform: translateX(-140px) rotate(-10deg);
    }
    body.open .heart-half.right{
      transform: translateX(140px) rotate(10deg);
    }

    /* Carta */
    .letter{
      width: min(640px, 92vw);
      margin: 22px auto 0;
      background: var(--paper);
      color: var(--ink);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 22px 22px 18px;
      text-align:left;

      opacity: 0;
      transform: translateY(20px) scale(.985);
      transition: opacity 550ms ease, transform 550ms ease;
      pointer-events:none;
    }
    body.open .letter{
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
      transition-delay: 180ms;
    }

    .letter .title{
      font-family: "Great Vibes", cursive;
      font-size: clamp(34px, 5vw, 54px);
      margin: 6px 0 10px;
      line-height: 1;
    }
    .letter .content{
      font-size: 16px;
      line-height: 1.6;
      margin: 0 0 14px;
      white-space: pre-wrap; /* respeta saltos de l√≠nea */
    }
    .letter .signature{
      font-weight: 600;
      margin-top: 6px;
    }

    /* Peque√±a nota */
    .small{
      font-size: 12px;
      opacity: .7;
      margin-top: 10px;
    }

    /* Responsivo */
    @media (max-width: 520px){
      body.open .heart-half.left{ transform: translateX(-105px) rotate(-10deg); }
      body.open .heart-half.right{ transform: translateX(105px) rotate(10deg); }
      .letter{ padding: 18px 16px 14px; }
    }
  
    /* Carta con contorno rosa iluminado (aplica a ambas cartas) */
    .letter.glow{
      border: 2px solid rgba(255, 120, 200, .55);
      box-shadow: var(--shadow),
                  0 0 0 2px rgba(255, 120, 200, .18),
                  0 0 28px rgba(255, 120, 200, .22);
    }

    /* Coraz√≥n intermedio (sale a los 20s) */
    .next-heart{
      display: block;
      position: relative;
      z-index: 2;
      width: min(240px, 70vw);
      margin: 22px auto 0;
      opacity: 0;
      transform: translateY(18px) scale(.92);
      transition: opacity 500ms ease, transform 500ms ease;
      pointer-events: none;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.55));
      user-select: none;
    }
    .next-heart button{
      width: 100%;
      border: 0;
      background: transparent;
      padding: 0;
      cursor: pointer;
      display: block;
    }
    .next-heart svg{ width: 100%; height: auto; display:block; }

    /* Cuando pasan 20s: la primera carta se ‚Äúconvierte‚Äù en coraz√≥n */
    body.to-heart #letter{
      opacity: 0 !important;
      transform: translateY(18px) scale(.985) !important;
      pointer-events: none !important;
      transition-delay: 0ms !important;
    }
    body.to-heart .next-heart{
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
      transition-delay: 120ms;
    }

    /* Segunda carta (oculta hasta que se presione el coraz√≥n) */
    #letter2{
      opacity: 0;
      transform: translateY(20px) scale(.985);
      pointer-events: none;
    }
    body.show-second #letter2{
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
      transition-delay: 140ms;
    }
    body.show-second .next-heart{
      opacity: 0;
      transform: translateY(18px) scale(.92);
      pointer-events: none;
      transition-delay: 0ms;
    }

  </style>
</head>

<body>
    <!-- Fondo animado -->
  <canvas id="fx"></canvas>

<main class="scene">
    <button class="heart-button" id="toggle" aria-label="Abrir la carta">
      <div class="heart-wrap" aria-hidden="true">
        <!-- MITAD IZQUIERDA -->
        <div class="heart-half left">
          <svg viewBox="0 0 512 512" role="img" aria-label="Coraz√≥n">
            <defs>
              <linearGradient id="gLeft" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="var(--heart2)"/>
                <stop offset="1" stop-color="var(--heart1)"/>
              </linearGradient>
              <clipPath id="clipLeft">
                <rect x="0" y="0" width="256" height="512"></rect>
              </clipPath>
            </defs>

            <g clip-path="url(#clipLeft)">
              <!-- Coraz√≥n -->
              <path
                fill="url(#gLeft)"
                d="M256 472s-32-25-62-47c-79-58-146-117-146-203
                   0-62 45-110 104-110 41 0 73 20 104 55
                   31-35 63-55 104-55 59 0 104 48 104 110
                   0 86-67 145-146 203-30 22-62 47-62 47z"
              />
              <!-- Texto dentro (se recorta a la mitad tambi√©n) -->
              <text
                x="256" y="295"
                text-anchor="middle"
                font-size="64"
                font-family="Great Vibes, cursive"
                fill="rgba(255,255,255,.92)"
                style="paint-order:stroke; stroke: rgba(0,0,0,.18); stroke-width: 6px;"
              >Michelle</text>
            </g>
          </svg>
        </div>

        <!-- MITAD DERECHA -->
        <div class="heart-half right">
          <svg viewBox="0 0 512 512" role="img" aria-label="Coraz√≥n">
            <defs>
              <linearGradient id="gRight" x1="1" y1="0" x2="0" y2="1">
                <stop offset="0" stop-color="var(--heart2)"/>
                <stop offset="1" stop-color="var(--heart1)"/>
              </linearGradient>
              <clipPath id="clipRight">
                <rect x="256" y="0" width="256" height="512"></rect>
              </clipPath>
            </defs>

            <g clip-path="url(#clipRight)">
              <path
                fill="url(#gRight)"
                d="M256 472s-32-25-62-47c-79-58-146-117-146-203
                   0-62 45-110 104-110 41 0 73 20 104 55
                   31-35 63-55 104-55 59 0 104 48 104 110
                   0 86-67 145-146 203-30 22-62 47-62 47z"
              />
              <text
                x="256" y="295"
                text-anchor="middle"
                font-size="64"
                font-family="Great Vibes, cursive"
                fill="rgba(255,255,255,.92)"
                style="paint-order:stroke; stroke: rgba(0,0,0,.18); stroke-width: 6px;"
              >Michelle</text>
            </g>
          </svg>
        </div>
      </div>
    </button>

    <div class="hint" id="hint">Haz click para abrir üíå</div>

    <section class="letter glow" id="letter" aria-live="polite">
      <div class="title">Mi carta para ti</div>

      <!-- ‚úÖ AQU√ç EDITAS TU TEXTO (puedes poner saltos de l√≠nea) -->
      <p class="content" id="letterText">Hola Cachetona,

          Amor, espero que te guste mi carta, en verdad te quisiera dar flores o algo que siempre hayas querido, aun asi se que valoras cualquier cosa que haga, como siempre, en verdad me siento muy afortunado de ternete conmigo cada dia, contigo a mi lado nada es aburrido y siempre estoy feliz, gracias por estar para mi aunque a veces estes estresada, siempre estare agradecido contigo por darme la oportunidad de desmotrarte mi amor

Te amo ,</p>

      <!-- ‚úÖ FIRMA (opcional) -->
      <div class="signature" id="signature">De rick</div>
    </section>
    <!-- Coraz√≥n que aparece 20s despu√©s (click para ver nueva carta) -->
    <div class="next-heart" id="nextHeart" aria-hidden="false">
      <button type="button" aria-label="Abrir la segunda carta">
        <svg viewBox="0 0 512 512" role="img" aria-label="Coraz√≥n">
          <defs>
            <linearGradient id="gNext" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="var(--heart2)"/>
              <stop offset="1" stop-color="var(--heart1)"/>
            </linearGradient>
          </defs>
          <path
            fill="url(#gNext)"
            d="M256 472s-32-25-62-47c-79-58-146-117-146-203
               0-62 45-110 104-110 41 0 73 20 104 55
               31-35 63-55 104-55 59 0 104 48 104 110
               0 86-67 145-146 203-30 22-62 47-62 47z"
          />
          <text
            x="256" y="305"
            text-anchor="middle"
            font-size="52"
            font-family="Great Vibes, cursive"
            fill="rgba(255,255,255,.92)"
            style="paint-order:stroke; stroke: rgba(0,0,0,.18); stroke-width: 6px;"
          >T√≥came</text>
        </svg>
      </button>
    </div>

    <!-- Segunda carta -->
    <section class="letter glow" id="letter2" aria-live="polite">
      <div class="title">Mi segunda carta para ti</div>

      <!-- ‚úÖ EDITA TU SEGUNDA CARTA AQU√ç -->
      <p class="content" id="letterText2">De verdad te adoro y siempre me sentire orgulloso de la persona que eres, tambien por la confianza que tienes ahora conmigo, te juro que todo lo que venga de ti se quedara siempre conmigo, todo lo que has compartido conmigo de verdad lo aprecio mucho, y espero algun dia poder abrirme mas contigo, no se expresarme pero contigo aprendere a hacerlo. TE AMO CACHETONA</p>

      <div class="signature" id="signature2">Tu nombre aqu√≠</div>
      <div class="small">Puedes cerrar la carta principal cuando quieras.</div>
    </section>

  </main>

  <script>
    const toggleBtn = document.getElementById("toggle");
    const hint = document.getElementById("hint");

    function setOpen(isOpen){
      document.body.classList.toggle("open", isOpen);
      // Reiniciar etapas cada vez que abras/cierres
      resetStages();
      if (isOpen){
        stageTimer = setTimeout(() => {
          if (document.body.classList.contains("open") && !document.body.classList.contains("show-second")) {
            document.body.classList.add("to-heart");
          }
        }, 20000);
      }
      toggleBtn.setAttribute("aria-label", isOpen ? "Cerrar la carta" : "Abrir la carta");
      hint.textContent = isOpen ? "Haz click para cerrar üíó" : "Haz click para abrir üíå";
    }


    /* ===========================
       Etapa 2: a los 20s, la carta se convierte en coraz√≥n
       Etapa 3: click al coraz√≥n -> segunda carta
    ============================ */
    const nextHeart = document.getElementById("nextHeart");
    const letter2 = document.getElementById("letter2");
    let stageTimer = null;

    function resetStages(){
      document.body.classList.remove("to-heart", "show-second");
      if (stageTimer){
        clearTimeout(stageTimer);
        stageTimer = null;
      }
    }

    // Click del coraz√≥n intermedio -> mostrar segunda carta
    if (nextHeart){
      nextHeart.addEventListener("click", (e) => {
        e.stopPropagation();
        document.body.classList.remove("to-heart");
        document.body.classList.add("show-second");
      });
    }
    // Click en cualquier parte del bot√≥n/coraz√≥n
    toggleBtn.addEventListener("click", () => {
      const isOpen = document.body.classList.contains("open");
      setOpen(!isOpen);
    });

    // Opcional: tecla Escape para cerrar
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setOpen(false);
    });
  
    /* ===========================
       Corazones brillantes cayendo
       + explotan al hacer click
       (canvas)
    ============================ */
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha: true });

    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    function resizeFx(){
      canvas.width = Math.floor(innerWidth * DPR);
      canvas.height = Math.floor(innerHeight * DPR);
      canvas.style.width = innerWidth + "px";
      canvas.style.height = innerHeight + "px";
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    }
    addEventListener("resize", resizeFx);
    resizeFx();

    const falling = [];  // corazones que caen
    const burst = [];    // corazones de explosi√≥n
    let lastT = performance.now();
    let spawnAcc = 0;

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function heartPath(c, size){
      c.beginPath();
      const s = size;
      c.moveTo(0, -0.22*s);
      c.bezierCurveTo( 0.50*s, -0.78*s,  1.18*s, -0.08*s, 0, 0.92*s);
      c.bezierCurveTo(-1.18*s, -0.08*s, -0.50*s, -0.78*s, 0, -0.22*s);
      c.closePath();
    }

    function drawHeart(x, y, size, rot, alpha, glow){
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(rot);

      ctx.shadowBlur = glow;
      ctx.shadowColor = `rgba(255, 90, 170, ${0.7 * alpha})`;

      const g = ctx.createLinearGradient(-size, -size, size, size);
      g.addColorStop(0, `rgba(255, 125, 195, ${alpha})`);
      g.addColorStop(1, `rgba(255, 60, 110, ${alpha})`);
      ctx.fillStyle = g;

      heartPath(ctx, size);
      ctx.fill();

      // highlight sutil
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 0.18 * alpha;
      ctx.fillStyle = "white";
      ctx.beginPath();
      ctx.ellipse(-0.22*size, -0.18*size, 0.18*size, 0.12*size, -0.6, 0, Math.PI*2);
      ctx.fill();

      ctx.restore();
    }

    function spawnFalling(){
      if (falling.length > 70) return;
      const size = rand(8, 18);
      const x = rand(10, innerWidth - 10);
      const y = rand(-40, -10);
      falling.push({
        x, y,
        r: size,
        vy: rand(18, 55),
        drift: rand(12, 40),
        phase: rand(0, Math.PI*2),
        w: rand(0.8, 1.8),
        rot: rand(-0.6, 0.6),
        vr: rand(-0.6, 0.6),
        glow: rand(8, 18),
        alpha: rand(0.55, 0.95)
      });
    }

    function explodeAt(h){
      const count = Math.floor(rand(10, 18));
      for (let i=0; i<count; i++){
        const ang = rand(0, Math.PI*2);
        const spd = rand(90, 220);
        burst.push({
          x: h.x,
          y: h.y,
          r: rand(Math.max(5, h.r*0.35), Math.max(7, h.r*0.55)),
          vx: Math.cos(ang) * spd,
          vy: Math.sin(ang) * spd - rand(20, 80),
          rot: rand(-1.2, 1.2),
          vr: rand(-2.4, 2.4),
          life: 0,
          ttl: rand(0.55, 0.95),
          glow: rand(6, 14),
          alpha: 1
        });
      }
    }

    function updateFx(dt){
      spawnAcc += dt;
      const rate = 0.13; // menor = m√°s corazones
      while (spawnAcc > rate){
        spawnAcc -= rate;
        spawnFalling();
      }

      for (let i = falling.length - 1; i >= 0; i--){
        const h = falling[i];
        h.phase += h.w * dt;
        h.x += Math.sin(h.phase) * (h.drift * dt);
        h.y += h.vy * dt;
        h.rot += h.vr * dt;

        if (h.y - h.r > innerHeight + 60) falling.splice(i, 1);
      }

      const g = 420;
      for (let i = burst.length - 1; i >= 0; i--){
        const p = burst[i];
        p.life += dt;
        const t = p.life / p.ttl;

        p.vy += g * dt;
        p.vx *= Math.pow(0.985, 60 * dt);
        p.vy *= Math.pow(0.985, 60 * dt);

        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.rot += p.vr * dt;

        p.alpha = Math.max(0, 1 - t);
        if (p.life >= p.ttl) burst.splice(i, 1);
      }
    }

    function renderFx(){
      ctx.clearRect(0, 0, innerWidth, innerHeight);
      for (const h of falling) drawHeart(h.x, h.y, h.r, h.rot, h.alpha, h.glow);
      for (const p of burst) drawHeart(p.x, p.y, p.r, p.rot, p.alpha, p.glow);
    }

    function loopFx(now){
      const dt = Math.min(0.033, (now - lastT) / 1000);
      lastT = now;
      updateFx(dt);
      renderFx();
      requestAnimationFrame(loopFx);
    }
    requestAnimationFrame(loopFx);

    function hitTest(x, y){
      for (let i = falling.length - 1; i >= 0; i--){
        const h = falling[i];
        const dx = x - h.x, dy = y - h.y;
        const rad = h.r * 1.05;
        if (dx*dx + dy*dy <= rad*rad) return i;
      }
      return -1;
    }

    // Click para explotar corazones del fondo (sin interferir con el coraz√≥n principal/carta)
    document.addEventListener("click", (e) => {
      // Si el click fue en el bot√≥n del coraz√≥n principal (o dentro), no explotamos nada
      if (e.target && e.target.closest && e.target.closest("#toggle, #nextHeart, .letter")) return;

      const x = e.clientX;
      const y = e.clientY;

      const idx = hitTest(x, y);
      if (idx !== -1){
        const h = falling[idx];
        explodeAt(h);
        falling.splice(idx, 1);
        e.stopPropagation();
      }
    }, true);

  </script>
</body>
</html>
